<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <base href="./" />
    <title>WeFlora</title>
    
    <!-- 1) GLOBAL ERROR TRAPS & UTILS -->
    <script>
      (function() {
        window.errLog = [];
        window.logDiag = function(msg) {
          const ts = new Date().toISOString().split('T')[1].slice(0, -1);
          const line = `[${ts}] ${msg}`;
          console.log(line);
          window.errLog.push(line);
          const el = document.getElementById('diag-output');
          if (el) el.textContent = window.errLog.join('\n');
        };

        window.addEventListener("error", (e) => window.logDiag(`!! ERROR: ${e.message}`));
        window.addEventListener("unhandledrejection", (e) => window.logDiag(`!! REJECT: ${e.reason}`));
      })();
    </script>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      if (typeof process === 'undefined') {
        window.process = { env: { NODE_ENV: 'development' } };
      }
    </script>

    <style>
      #runtime-badge {
        position: fixed;
        top: 0;
        right: 0;
        z-index: 99999;
        background: rgba(0, 0, 0, 0.85);
        color: #0f0;
        font-family: monospace;
        font-size: 11px;
        padding: 4px 8px;
        border-bottom-left-radius: 6px;
        pointer-events: none;
        white-space: pre;
        backdrop-filter: blur(2px);
      }
      #runtime-badge.error {
        background: rgba(220, 38, 38, 0.95);
        color: white;
        font-weight: bold;
      }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-router-dom": "https://esm.sh/react-router-dom@^7.10.1",
    "react/": "https://esm.sh/react@^19.2.3/",
    "react-dom": "https://esm.sh/react-dom@^19.2.3",
    "@google/genai": "https://esm.sh/@google/genai@^1.34.0",
    "@supabase/supabase-js": "https://esm.sh/@supabase/supabase-js@^2.88.0"
  }
}
</script>
</head>
  <body class="bg-gray-50 h-screen overflow-hidden">
    <div id="runtime-badge">Init...</div>
    <div id="root" class="h-full w-full"></div>

    <!-- EMBEDDED SOURCE FALLBACK (Strategy B) - URI Encoded JS Chunks -->
    <script id="app-source-json" type="application/json">
    {
      "buildId": "boot-strict-v6-debug",
      "jsChunksEnc": [
        "%2F**%0A%20*%20app.entry.mjs%20(The%20Bootloader)%0A%20*%20Handles%3A%20Feature%20Flags%2C%20State%20Snapshots%2C%20Dual-Boot%2C%20and%20Restoration%20Tools.%0A%20*%2F%0A%0Aconst%20BUILD_ID%20%3D%20%22boot-strict-v6-debug%22%3B%0A%0A%2F%2F%20---%201.%20Utilities%20---%0Aconst%20SNAPSHOT_KEY%20%3D%20'flora_snapshots'%3B%0Aconst%20FLAGS_KEY%20%3D%20'flora_flags'%3B%0A%0A%2F%2F%20Obfuscate%20markers%20to%20ensure%20this%20file%20doesn't%20flag%20itself%20during%20a%20scan%0Aconst%20M_V%20%3D%20'19'%20%2B%20'.2.3'%3B%20%0Aconst%20M_R%20%3D%20'react'%20%2B%20'%40%5E19'%3B%20%0Aconst%20M_D%20%3D%20'react-dom'%20%2B%20'%40%5E19'%3B%20%0Aconst%20M_ESM%20%3D%20'esm'%20%2B%20'.sh'%3B%20%0Aconst%20M_IM_WORD%20%3D%20'import'%20%2B%20'map'%3B%20%2F%2F%20Obfuscated%20keyword%0Aconst%20M_IM%20%3D%20'type%3D'%20%2B%20'%22'%20%2B%20M_IM_WORD%20%2B%20'%22'%3B%20%0Aconst%20M_RS%20%3D%20'%22react'%20%2B%20'%2F%22%3A'%3B%20%0Aconst%20M_DS%20%3D%20'%22react-dom'%20%2B%20'%2F%22%3A'%3B%20%0Aconst%20M_RP%20%3D%20'%2Freact'%20%2B%20'%40%5E19'%3B%0Aconst%20M_DP%20%3D%20'%2Freact-dom'%20%2B%20'%40%5E19'%3B%0A%0Aconst%20FORBIDDEN_MARKERS%20%3D%20%5B%0A%20%20%20%20M_R%2C%20M_D%2C%20M_V%2C%20M_ESM%2C%20M_IM%2C%0A%20%20%20%20M_RS%2C%20M_DS%2C%20M_RP%2C%20M_DP%0A%5D%3B%0A%0A%2F%2F%20Simple%20Adler-32%20hash%20for%20integrity%20checks%0Afunction%20adler32(str)%20%7B%0A%20%20%20%20let%20a%20%3D%201%2C%20b%20%3D%200%2C%20L%20%3D%20str.length%2C%20M%20%3D%2065521%3B%0A%20%20%20%20for%20(let%20i%20%3D%200%3B%20i%20%3C%20L%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20let%20c%20%3D%20str.charCodeAt(i)%3B%0A%20%20%20%20%20%20%20%20a%20%3D%20(a%20%2B%20c)%20%25%20M%3B%0A%20%20%20%20%20%20%20%20b%20%3D%20(b%20%2B%20a)%20%25%20M%3B%0A%20%20%20%20%7D%0A%20%20%20%20return%20(b%20%3C%3C%2016)%20%7C%20a%3B%0A%7D%0A%0A%2F%2F%20Convert%20string%20to%20Base64%0Afunction%20toBase64(str)%20%7B%0A%20%20%20%20return%20btoa(unescape(encodeURIComponent(str)))%3B%0A%7D%0A%0Aconst%20SnapshotManager%20%3D%20%7B%0A%20%20%20%20take%3A%20()%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20const%20state%20%3D%20%7B%7D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20for(let%20i%3D0%3B%20i%3ClocalStorage.length%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20k%20%3D%20localStorage.key(i)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(k%20%26%26%20(k.startsWith('flora')%20%7C%7C%20k.includes('supabase')))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20state%5Bk%5D%20%3D%20localStorage.getItem(k)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20const%20id%20%3D%20Date.now()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20const%20snapshots%20%3D%20JSON.parse(localStorage.getItem(SNAPSHOT_KEY)%20%7C%7C%20'%5B%5D')%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20snapshots.unshift(%7B%20id%3A%20id%2C%20ts%3A%20new%20Date().toISOString()%2C%20data%3A%20state%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if(snapshots.length%20%3E%2010)%20snapshots.pop()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20localStorage.setItem(SNAPSHOT_KEY%2C%20JSON.stringify(snapshots))%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20console.log(%60%5BBOOT%5D%20Snapshot%20taken%20(%24%7Bid%7D).%20Total%3A%20%24%7Bsnapshots.length%7D%60)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20id%3B%0A%20%20%20%20%20%20%20%20%7D%20catch(e)%20%7B%20%0A%20%20%20%20%20%20%20%20%20%20%20%20console.error(%22%5BBOOT%5D%20Snapshot%20failed%22%2C%20e)%3B%20%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20null%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%2C%0A%20%20%20%20restore%3A%20(id)%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20const%20snapshots%20%3D%20JSON.parse(localStorage.getItem(SNAPSHOT_KEY)%20%7C%7C%20'%5B%5D')%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20const%20snap%20%3D%20snapshots.find(s%20%3D%3E%20s.id%20%3D%3D%3D%20id)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if(!snap)%20return%20false%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20const%20preserve%20%3D%20%5BSNAPSHOT_KEY%2C%20FLAGS_KEY%2C%20'weflora.originalDisabled'%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20for(let%20i%3DlocalStorage.length-1%3B%20i%3E%3D0%3B%20i--)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20k%20%3D%20localStorage.key(i)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(k%20%26%26%20!preserve.includes(k))%20localStorage.removeItem(k)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20Object.entries(snap.data).forEach((%5Bk%2C%20v%5D)%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(typeof%20v%20%3D%3D%3D%20'string')%20localStorage.setItem(k%2C%20v)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20console.log(%60%5BBOOT%5D%20Restored%20snapshot%20%24%7Bid%7D%60)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20true%3B%0A%20%20%20%20%20%20%20%20%7D%20catch(e)%20%7B%20console.error(%22%5BBOOT%5D%20Restore%20failed%22%2C%20e)%3B%20return%20false%3B%20%7D%0A%20%20%20%20%7D%0A%7D%3B%0A%0Aconst%20Flags%20%3D%20%7B%0A%20%20%20%20get%3A%20()%20%3D%3E%20JSON.parse(localStorage.getItem(FLAGS_KEY)%20%7C%7C%20'%7B%7D')%2C%0A%20%20%20%20set%3A%20(key%2C%20val)%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20const%20f%20%3D%20Flags.get()%3B%0A%20%20%20%20%20%20%20%20f%5Bkey%5D%20%3D%20val%3B%0A%20%20%20%20%20%20%20%20localStorage.setItem(FLAGS_KEY%2C%20JSON.stringify(f))%3B%0A%20%20%20%20%7D%2C%0A%20%20%20%20reset%3A%20()%20%3D%3E%20localStorage.removeItem(FLAGS_KEY)%0A%7D%3B%0A%0A%2F%2F%20---%202.%20Safe%20Mode%20UI%20---%0Afunction%20mountSafeMode(rootElement%2C%20React%2C%20createRoot%2C%20errorMsg)%20%7B%0A%20%20%20%20const%20e%20%3D%20React.createElement%3B%0A%20%20%20%20const%20%7B%20useState%2C%20useEffect%20%7D%20%3D%20React%3B%0A%0A%20%20%20%20function%20SafeApp()%20%7B%0A%20%20%20%20%20%20%20%20const%20%5BactiveTab%2C%20setActiveTab%5D%20%3D%20useState('restoration')%3B%0A%20%20%20%20%20%20%20%20const%20%5Bsnapshots%2C%20setSnapshots%5D%20%3D%20useState(%5B%5D)%3B%0A%20%20%20%20%20%20%20%20const%20%5BdiagLog%2C%20setDiagLog%5D%20%3D%20useState(window%5B'errLog'%5D%20%7C%7C%20%5B%5D)%3B%0A%20%20%20%20%20%20%20%20const%20%5BrestoreLog%2C%20setRestoreLog%5D%20%3D%20useState(%5B%5D)%3B%0A%20%20%20%20%20%20%20%20const%20%5BisProcessing%2C%20setIsProcessing%5D%20%3D%20useState(false)%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%2F%2F%20Bundle%20Text%20Fallback%20State%0A%20%20%20%20%20%20%20%20const%20%5BbundleText%2C%20setBundleText%5D%20%3D%20useState('')%3B%0A%20%20%20%20%20%20%20%20const%20%5BshowBundleText%2C%20setShowBundleText%5D%20%3D%20useState(false)%3B%0A%0A%20%20%20%20%20%20%20%20useEffect(()%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20const%20snaps%20%3D%20JSON.parse(localStorage.getItem(SNAPSHOT_KEY)%20%7C%7C%20'%5B%5D')%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20setSnapshots(snaps)%3B%0A%20%20%20%20%20%20%20%20%7D%2C%20%5B%5D)%3B%0A%0A%20%20%20%20%20%20%20%20const%20appendLog%20%3D%20(msg)%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20setRestoreLog(prev%20%3D%3E%20%5B...prev%2C%20%60%5B%24%7Bnew%20Date().toLocaleTimeString()%7D%5D%20%24%7Bmsg%7D%60%5D)%3B%0A%20%20%20%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20%20%20%20%20const%20handleRetry%20%3D%20()%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20localStorage.removeItem(%22weflora.originalDisabled%22)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20window.location.search%20%3D%20'%3Fmode%3Doriginal%26retry%3D'%20%2B%20Date.now()%3B%0A%20%20%20%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20%20%20%20%20const%20executeIntegrityCheck%20%3D%20async%20()%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20appendLog('Fetching%20manifest...')%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20r%20%3D%20await%20fetch('.%2Frestore%2Fmanifest.json')%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(!r.ok)%20throw%20new%20Error(%22Manifest%20not%20found%22)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20manifest%20%3D%20await%20r.json()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20passed%20%3D%200%2C%20failed%20%3D%200%2C%20totalBytes%20%3D%200%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for(const%20f%20of%20manifest.files)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20fileRes%20%3D%20await%20fetch(f.path)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(fileRes.ok)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20text%20%3D%20await%20fileRes.text()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20hash%20%3D%20adler32(text)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20totalBytes%20%2B%3D%20text.length%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(f.checksum%20IT%3D%3D%20null%20%26%26%20f.checksum%20!%3D%3D%20hash)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20appendLog(%60%5BFAIL%5D%20%24%7Bf.path%7D%3A%20Hash%20mismatch%60)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20failed%2B%2B%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20appendLog(%60%5BPASS%5D%20%24%7Bf.path%7D%20(%24%7Btext.length%7Db)%60)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20passed%2B%2B%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20appendLog(%60%5BMISSING%5D%20%24%7Bf.path%7D%20(%24%7BfileRes.status%7D)%60)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20failed%2B%2B%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20catch(err)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20appendLog(%60%5BERROR%5D%20%24%7Bf.path%7D%3A%20%24%7Berr.message%7D%60)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20failed%2B%2B%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20appendLog(%60Result%3A%20%24%7Bpassed%7D%20Passed%2C%20%24%7Bfailed%7D%20Failed.%60)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20failed%20%3D%3D%3D%200%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20catch(e)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20appendLog(%60CRITICAL%3A%20%24%7Be.message%7D%60)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20false%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20%20%20%20%20const%20handleVerifyIntegrity%20%3D%20async%20()%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20setIsProcessing(true)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20setRestoreLog(%5B%5D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20await%20executeIntegrityCheck()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20setIsProcessing(false)%3B%0A%20%20%20%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20%20%20%20%20const%20handleExportBundle%20%3D%20async%20()%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20setIsProcessing(true)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20setRestoreLog(%5B'Preparing%20bundle...'%5D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20const%20origin%20%3D%20window.location.origin%20%7C%7C%20''%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20const%20base%20%3D%20document.baseURI%20%7C%7C%20''%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20const%20isSandbox%20%3D%20origin.includes('ai.studio')%20%7C%7C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20origin.includes('usercontent.goog')%20%7C%7C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20window.location.protocol%20%3D%3D%3D%20'file%3A'%20%7C%7C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20base.startsWith('data%3A')%20%7C%7C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20base.startsWith('blob%3A')%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20r%20%3D%20await%20fetch('.%2Frestore%2Fmanifest.json')%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20manifest%20%3D%20await%20r.json()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20bundle%20%3D%20%7B%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20metadata%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20timestamp%3A%20new%20Date().toISOString()%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20buildId%3A%20BUILD_ID%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20origin%3A%20window.location.origin%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20manifest%3A%20manifest%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20files%3A%20%7B%7D%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20lintFailures%20%3D%20%5B%5D%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for(const%20f%20of%20manifest.files)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20text%20%3D%20''%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(f.path%20%3D%3D%3D%20'index.html'%20%26%26%20isSandbox)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20appendLog(%60%5BDIAG%5D%20index.html%3A%20Using%20Runtime%20DOM%60)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text%20%3D%20document.documentElement.outerHTML%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Sanitize%3A%20Use%20M_IM_WORD%20to%20avoid%20literal%20in%20logic%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Matches%20%3Cscript%20...%20type%3D%22importmap%22%20...%20%3E%20...%20%3C%2Fscript%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20reIm%20%3D%20new%20RegExp('%3Cscript%5B%5E%3E%5D*'%20%2B%20'type%3D%5B%22%5C'%5D'%20%2B%20M_IM_WORD%20%2B%20'%5B%22%5C'%5D'%20%2B%20'%5B%5E%3E%5D*%3E%5B%5C%5Cs%5C%5CS%5D*%3F%3C%5C%5C%2Fscript%3E'%2C%20'gi')%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20while%20(reIm.test(text))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text%20%3D%20text.replace(reIm%2C%20'')%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20reAlias%20%3D%20%2F%3Cscript%5B%5E%3E%5D*type%3D%5B%22'%5Dmodule%5B%22'%5D%5B%5E%3E%5D*%3E%5B%5Cs%5CS%5D*%3Fimport%5Cs%2B%5B'%22%5D%40%5C%2Findex%5B'%22%5D%5B%5Cs%5CS%5D*%3F%3C%5C%2Fscript%3E%2Fgi%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text%20%3D%20text.replace(reAlias%2C%20'')%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20reEsm%20%3D%20new%20RegExp('https%3F%3A%2F%2F'%20%2B%20'esm'%20%2B%20'%5C%5C.sh'%20%2B%20'%2F%5B%5E%22%5C'%5C%5Cs%5D%2B'%2C%20'gi')%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text%20%3D%20text.replace(reEsm%2C%20'')%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text%20%3D%20text.replace(%2Fconst%20REACT_URL%20%3D.*%3F%3B%2F%2C%20%60const%20REACT_URL%20%3D%20%22https%3A%2F%2Fcdn.jsdelivr.net%2Fnpm%2Freact%4018.2.0%2F%2Besm%22%3B%60)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text%20%3D%20text.replace(%2Fconst%20DOM_URL%20%3D.*%3F%3B%2F%2C%20%60const%20DOM_URL%20%3D%20%22https%3A%2F%2Fcdn.jsdelivr.net%2Fnpm%2Freact-dom%4018.2.0%2Fclient%2F%2Besm%22%3B%60)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20appendLog(%60%5BDIAG%5D%20Sanitized%20DOM%20Length%3A%20%24%7Btext.length%7D%60)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20fileRes%20%3D%20await%20fetch(f.path)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(fileRes.ok)%20text%20%3D%20await%20fileRes.text()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20appendLog(%60%5BERROR%5D%20Failed%20to%20fetch%20%24%7Bf.path%7D%60)%3B%20continue%3B%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Proof%20Check%3A%20Use%20M_IM_WORD%20to%20avoid%20literal%20string%20in%20source%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(f.path%20%3D%3D%3D%20'index.html'%20%7C%7C%20f.path%20%3D%3D%3D%20'app.entry.mjs')%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20esmCount%20%3D%20text.split(M_ESM).length%20-%201%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20imCount%20%3D%20text.split(M_IM_WORD).length%20-%201%3B%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20appendLog(%60%5BPROOF%5D%20%24%7Bf.path%7D%3A%20%24%7BM_ESM%7D%3D%24%7BesmCount%7D%2C%20im%3D%24%7BimCount%7D%60)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(esmCount%20%3E%200%20%7C%7C%20(f.path%20%3D%3D%3D%20'index.html'%20%26%26%20imCount%20%3E%200))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20lintFailures.push(%60PROOF%20FAILED%3A%20%24%7Bf.path%7D%20still%20contains%20forbidden%20markers%60)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bundle.files%5Bf.path%5D%20%3D%20toBase64(text)%3B%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20appendLog(%60Bundled%3A%20%24%7Bf.path%7D%60)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20catch(err)%20%7B%20console.error(err)%3B%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(lintFailures.length%20%3E%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20setRestoreLog(prev%20%3D%3E%20%5B...prev%2C%20'---%20EXPORT%20BLOCKED%20---'%2C%20...lintFailures%5D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20setIsProcessing(false)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Deterministic%20Text%20Generation%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20jsonStr%20%3D%20JSON.stringify(bundle%2C%20null%2C%202)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20setBundleText(jsonStr)%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20blob%20%3D%20new%20Blob(%5BjsonStr%5D%2C%20%7Btype%3A%20'application%2Fjson'%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20url%20%3D%20URL.createObjectURL(blob)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20a%20%3D%20document.createElement('a')%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20a.href%20%3D%20url%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20a.download%20%3D%20%60weflora-restore-bundle-%24%7BDate.now()%7D.json%60%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20a.click()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20appendLog('Bundle%20downloaded.')%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20catch(dlErr)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20appendLog(%60Download%20blocked%3A%20%24%7BdlErr.message%7D.%20Enable%20%22Show%20Text%22%20to%20copy%20manually.%60)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20setShowBundleText(true)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20catch(e)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20appendLog(%60Export%20Failed%3A%20%24%7Be.message%7D%60)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20setIsProcessing(false)%3B%0A%20%20%20%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20%20%20%20%20const%20handleExportState%20%3D%20()%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20const%20data%20%3D%20JSON.stringify(localStorage)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20const%20blob%20%3D%20new%20Blob(%5Bdata%5D%2C%20%7Btype%3A%20'application%2Fjson'%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20const%20url%20%3D%20URL.createObjectURL(blob)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20const%20a%20%3D%20document.createElement('a')%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20a.href%20%3D%20url%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20a.download%20%3D%20%60weflora-state-%24%7BDate.now()%7D.json%60%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20a.click()%3B%0A%20%20%20%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20%20%20%20%20const%20renderBundleTextUI%20%3D%20()%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(!showBundleText%20%7C%7C%20!bundleText)%20return%20null%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20const%20CHUNK_SIZE%20%3D%20750000%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20const%20totalChunks%20%3D%20Math.ceil(bundleText.length%20%2F%20CHUNK_SIZE)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20e('div'%2C%20%7B%20className%3A%20'mt-6%20p-4%20bg-slate-100%20border%20border-slate-300%20rounded-xl'%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('div'%2C%20%7B%20className%3A%20'flex%20justify-between%20items-center%20mb-2'%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('h3'%2C%20%7B%20className%3A%20'font-bold%20text-slate-800'%20%7D%2C%20'Bundle%20Text%20Fallback')%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('div'%2C%20%7B%20className%3A%20'text-xs%20text-slate-500'%20%7D%2C%20%60%24%7B(bundleText.length%2F1024%2F1024).toFixed(2)%7D%20MB%20%7C%20%24%7BtotalChunks%7D%20parts%60)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('textarea'%2C%20%7B%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20readOnly%3A%20true%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%3A%20bundleText%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20className%3A%20'w-full%20h-48%20p-2%20text-%5B10px%5D%20font-mono%20border%20border-slate-300%20rounded%20mb-4%20bg-white'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20onClick%3A%20(ev)%20%3D%3E%20ev.target.select()%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('div'%2C%20%7B%20className%3A%20'flex%20flex-wrap%20gap-2%20mb-4'%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('button'%2C%20%7B%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20onClick%3A%20()%20%3D%3E%20navigator.clipboard.writeText(bundleText).then(()%20%3D%3E%20alert('Copied%20all'))%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20className%3A%20'px-3%20py-1%20bg-slate-800%20text-white%20text-xs%20rounded%20font-bold%20hover%3Abg-slate-700'%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%2C%20'Copy%20All')%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20totalChunks%20%3E%201%20%26%26%20Array.from(%7Blength%3A%20totalChunks%7D).map((_%2C%20i)%20%3D%3E%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('button'%2C%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20key%3A%20i%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20onClick%3A%20()%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20chunk%20%3D%20bundleText.substring(i%20*%20CHUNK_SIZE%2C%20(i%20%2B%201)%20*%20CHUNK_SIZE)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20navigator.clipboard.writeText(chunk).then(()%20%3D%3E%20alert(%60Copied%20Part%20%24%7Bi%2B1%7D%2F%24%7BtotalChunks%7D%60))%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20className%3A%20'px-3%20py-1%20bg-white%20border%20border-slate-300%20text-slate-700%20text-xs%20rounded%20font-bold%20hover%3Abg-slate-50'%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%2C%20%60Part%20%24%7Bi%2B1%7D%60)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('div'%2C%20%7B%20className%3A%20'text-%5B10px%5D%20text-slate-500%20bg-slate-200%20p-2%20rounded'%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('strong'%2C%20%7B%7D%2C%20'Rebuild%20Instructions%3A%20')%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'Save%20parts%20as%20bundle.part1.txt%20etc.%2C%20then%20concatenate%20contents%20to%20restore.'%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%20%20%20%20)%3B%0A%20%20%20%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20%20%20%20%20return%20e('div'%2C%20%7B%20className%3A%20'flex%20h-screen%20w-full%20font-sans%20text-slate-900%20bg-slate-50%20overflow-hidden'%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20e('aside'%2C%20%7B%20className%3A%20'w-64%20bg-white%20border-r%20border-slate-200%20h-full%20flex%20flex-col'%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('div'%2C%20%7B%20className%3A%20'h-16%20flex%20items-center%20px-6%20border-b%20border-slate-100%20bg-amber-50'%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('div'%2C%20%7B%20className%3A%20'h-8%20w-8%20bg-amber-500%20rounded-lg%20flex%20items-center%20justify-center%20text-white%20font-bold%20mr-3'%20%7D%2C%20'!')%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('span'%2C%20%7B%20className%3A%20'font-bold%20text-amber-900'%20%7D%2C%20'Safe%20Mode')%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('nav'%2C%20%7B%20className%3A%20'flex-1%20p-4%20space-y-1'%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('button'%2C%20%7B%20onClick%3A%20()%20%3D%3E%20setActiveTab('restoration')%2C%20className%3A%20%60w-full%20text-left%20px-3%20py-2%20rounded-lg%20text-sm%20font-bold%20%24%7BactiveTab%20%3D%3D%3D%20'restoration'%20%3F%20'bg-amber-100%20text-amber-800'%20%3A%20'text-slate-600'%7D%60%20%7D%2C%20'Restoration')%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('button'%2C%20%7B%20onClick%3A%20()%20%3D%3E%20setActiveTab('snapshots')%2C%20className%3A%20%60w-full%20text-left%20px-3%20py-2%20rounded-lg%20text-sm%20font-bold%20%24%7BactiveTab%20%3D%3D%3D%20'snapshots'%20%3F%20'bg-amber-100%20text-amber-800'%20%3A%20'text-slate-600'%7D%60%20%7D%2C%20'Snapshots')%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('button'%2C%20%7B%20onClick%3A%20()%20%3D%3E%20setActiveTab('diagnostics')%2C%20className%3A%20%60w-full%20text-left%20px-3%20py-2%20rounded-lg%20text-sm%20font-bold%20%24%7BactiveTab%20%3D%3D%3D%20'diagnostics'%20%3F%20'bg-amber-100%20text-amber-800'%20%3A%20'text-slate-600'%7D%60%20%7D%2C%20'Diagnostics')%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('div'%2C%20%7B%20className%3A%20'p-4%20border-t%20border-slate-200'%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20!errorMsg.includes('Sandbox')%20%26%26%20e('button'%2C%20%7B%20onClick%3A%20handleRetry%2C%20className%3A%20'w-full%20py-2%20bg-slate-900%20text-white%20rounded-lg%20font-bold%20text-sm%20hover%3Abg-black%20transition-colors%20shadow-lg'%20%7D%2C%20'Retry%20Original%20App')%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20e('main'%2C%20%7B%20className%3A%20'flex-1%20p-8%20overflow-auto'%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('div'%2C%20%7B%20className%3A%20'max-w-3xl%20mx-auto'%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20errorMsg%20%26%26%20e('div'%2C%20%7B%20className%3A%20'mb-6%20p-4%20bg-green-50%20border%20border-green-200%20rounded-xl%20text-green-900%20text-sm%20font-mono%20shadow-sm'%20%7D%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('strong'%2C%20%7B%7D%2C%20'Status%3A%20')%2C%20errorMsg%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20activeTab%20%3D%3D%3D%20'restoration'%20%26%26%20e('div'%2C%20%7B%20className%3A%20'space-y-6'%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('h2'%2C%20%7B%20className%3A%20'text-xl%20font-bold%20text-slate-800'%20%7D%2C%20'Restoration%20Tools')%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('div'%2C%20%7B%20className%3A%20'grid%20grid-cols-2%20gap-4'%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('button'%2C%20%7B%20onClick%3A%20handleVerifyIntegrity%2C%20disabled%3A%20isProcessing%2C%20className%3A%20'p-4%20bg-white%20border%20border-slate-200%20rounded-xl%20hover%3Aborder-blue-500%20text-left'%20%7D%2C%20e('div'%2C%20%7B%20className%3A%20'font-bold'%20%7D%2C%20'Verify%20Integrity'))%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('button'%2C%20%7B%20onClick%3A%20handleExportBundle%2C%20disabled%3A%20isProcessing%2C%20className%3A%20'p-4%20bg-white%20border%20border-slate-200%20rounded-xl%20hover%3Aborder-green-500%20text-left'%20%7D%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('div'%2C%20%7B%20className%3A%20'font-bold'%20%7D%2C%20'Export%20Restore%20Bundle')%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('div'%2C%20%7B%20className%3A%20'text-xs%20text-slate-400%20font-normal%20mt-1'%20%7D%2C%20'Auto-download%20or%20view%20text')%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('button'%2C%20%7B%20onClick%3A%20()%20%3D%3E%20setShowBundleText(!showBundleText)%2C%20className%3A%20%60p-4%20border%20border-slate-200%20rounded-xl%20text-left%20%24%7BshowBundleText%20%3F%20'bg-slate-100'%20%3A%20'bg-white%20hover%3Aborder-slate-400'%7D%60%20%7D%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('div'%2C%20%7B%20className%3A%20'font-bold'%20%7D%2C%20'Toggle%20Text%20Mode')%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('div'%2C%20%7B%20className%3A%20'text-xs%20text-slate-400%20font-normal%20mt-1'%20%7D%2C%20'Manually%20copy%20bundle')%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('button'%2C%20%7B%20onClick%3A%20Flags.reset%2C%20className%3A%20'p-4%20bg-white%20border%20border-slate-200%20rounded-xl%20hover%3Aborder-amber-500%20text-left'%20%7D%2C%20e('div'%2C%20%7B%20className%3A%20'font-bold'%20%7D%2C%20'Reset%20Feature%20Flags'))%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('button'%2C%20%7B%20onClick%3A%20handleExportState%2C%20className%3A%20'p-4%20bg-white%20border%20border-slate-200%20rounded-xl%20hover%3Aborder-amber-500%20text-left'%20%7D%2C%20e('div'%2C%20%7B%20className%3A%20'font-bold'%20%7D%2C%20'Export%20State%20Snapshot'))%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20renderBundleTextUI()%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('div'%2C%20%7B%20className%3A%20'mt-6%20p-4%20bg-slate-900%20text-slate-300%20rounded-xl%20font-mono%20text-xs'%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('h3'%2C%20%7B%20className%3A%20'text-weflora-teal%20font-bold%20mb-2'%20%7D%2C%20'FORENSICS%20PROOF')%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('div'%2C%20%7B%7D%2C%20%60Runtime%20React%3A%20%24%7BReact.version%7D%60)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('div'%2C%20%7B%7D%2C%20%60Build%20ID%3A%20%24%7BBUILD_ID%7D%60)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('div'%2C%20%7B%20className%3A%20'mt-4'%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('h3'%2C%20%7B%20className%3A%20'text-sm%20font-bold%20text-slate-600%20mb-2'%20%7D%2C%20'Operation%20Log')%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('pre'%2C%20%7B%20className%3A%20'bg-slate-900%20text-green-400%20p-4%20rounded-xl%20text-xs%20overflow-auto%20h-48%20font-mono'%20%7D%2C%20restoreLog.join('%5Cn')%20%7C%7C%20'Ready...')%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20activeTab%20%3D%3D%3D%20'snapshots'%20%26%26%20e('div'%2C%20%7B%20className%3A%20'space-y-4'%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('h2'%2C%20%7B%20className%3A%20'text-xl%20font-bold%20text-slate-800'%20%7D%2C%20'System%20Snapshots')%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('button'%2C%20%7B%20onClick%3A%20()%20%3D%3E%20%7B%20SnapshotManager.take()%3B%20setSnapshots(JSON.parse(localStorage.getItem(SNAPSHOT_KEY)%7C%7C'%5B%5D'))%3B%20%7D%2C%20className%3A%20'text-xs%20bg-slate-200%20px-2%20py-1%20rounded'%20%7D%2C%20'%2B%20New%20Snapshot')%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20snapshots.map(s%20%3D%3E%20e('div'%2C%20%7B%20key%3A%20s.id%2C%20className%3A%20'flex%20items-center%20justify-between%20p-3%20bg-white%20border%20border-slate-200%20rounded-lg'%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('div'%2C%20%7B%7D%2C%20e('div'%2C%20%7B%20className%3A%20'font-mono%20text-xs%20text-slate-500'%20%7D%2C%20s.ts)%2C%20e('div'%2C%20%7B%20className%3A%20'text-sm%20font-bold'%20%7D%2C%20%60%24%7BObject.keys(s.data).length%7D%20keys%60))%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('button'%2C%20%7B%20onClick%3A%20()%20%3D%3E%20%7B%20if(SnapshotManager.restore(s.id))%20alert('Restored')%3B%20%7D%2C%20className%3A%20'px-3%20py-1%20bg-amber-100%20text-amber-700%20text-xs%20font-bold%20rounded%20hover%3Abg-amber-200'%20%7D%2C%20'Restore')%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20))%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20activeTab%20%3D%3D%3D%20'diagnostics'%20%26%26%20e('div'%2C%20%7B%20className%3A%20'space-y-4'%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('h2'%2C%20%7B%20className%3A%20'text-xl%20font-bold%20text-slate-800'%20%7D%2C%20'Boot%20Diagnostics')%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e('pre'%2C%20%7B%20className%3A%20'bg-black%20text-red-400%20p-4%20rounded-xl%20text-xs%20overflow-auto%20h-96%20font-mono'%20%7D%2C%20diagLog.join('%5Cn'))%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20const%20root%20%3D%20createRoot(rootElement)%3B%0A%20%20%20%20root.render(e(SafeApp))%3B%0A%7D%0A%0A%2F%2F%20---%203.%20Boot%20Logic%20---%0Aexport%20function%20mount(rootElement%2C%20React%2C%20createRoot)%20%7B%0A%20%20%20%20console.log(%60%5BBOOT%5D%20mount()%20called.%20Build%20ID%3A%20%24%7BBUILD_ID%7D%60)%3B%0A%20%20%20%20SnapshotManager.take()%3B%0A%0A%20%20%20%20const%20updateBadge%20%3D%20(text)%20%3D%3E%20%7B%20if%20(window%5B'updateBadgeGlobal'%5D)%20window%5B'updateBadgeGlobal'%5D(text)%3B%20%7D%3B%0A%20%20%20%20%0A%20%20%20%20const%20origin%20%3D%20window.location.origin%20%7C%7C%20''%3B%0A%20%20%20%20const%20base%20%3D%20document.baseURI%20%7C%7C%20''%3B%0A%20%20%20%20%0A%20%20%20%20const%20isSandbox%20%3D%20origin.includes('ai.studio')%20%7C%7C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20origin.includes('usercontent.goog')%20%7C%7C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20window.location.protocol%20%3D%3D%3D%20'file%3A'%20%7C%7C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20base.startsWith('data%3A')%20%7C%7C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20base.startsWith('blob%3A')%3B%0A%20%20%20%20%0A%20%20%20%20console.log(%60%5BBOOT%5D%20Sandbox%20Check%3A%20%24%7BisSandbox%7D%20(Origin%3A%20%24%7Borigin%7D)%60)%3B%0A%0A%20%20%20%20if%20(isSandbox)%20%7B%0A%20%20%20%20%20%20%20%20console.warn(%22%5BBOOT%5D%20Sandbox%20detected.%20Original%20app%20execution%20disabled.%22)%3B%0A%20%20%20%20%20%20%20%20updateBadge(%60SAFE%20(Sandbox)%20%7C%20%24%7BBUILD_ID%7D%60)%3B%0A%20%20%20%20%20%20%20%20mountSafeMode(rootElement%2C%20React%2C%20createRoot%2C%20%60Sandbox%20detected%20(%24%7Borigin%7D).%20Code%20execution%20disabled.%60)%3B%0A%20%20%20%20%20%20%20%20return%3B%20%0A%20%20%20%20%7D%0A%0A%20%20%20%20const%20params%20%3D%20new%20URLSearchParams(window.location.search)%3B%0A%20%20%20%20const%20forceSafe%20%3D%20params.get('safe')%20%3D%3D%3D%20'1'%3B%0A%20%20%20%20const%20isOriginalDisabled%20%3D%20localStorage.getItem(%22weflora.originalDisabled%22)%20%3D%3D%3D%20'1'%3B%0A%0A%20%20%20%20if%20(forceSafe%20%7C%7C%20isOriginalDisabled)%20%7B%0A%20%20%20%20%20%20%20%20updateBadge(%60SAFE%20(User)%20%7C%20%24%7BBUILD_ID%7D%60)%3B%0A%20%20%20%20%20%20%20%20const%20msg%20%3D%20isOriginalDisabled%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%3F%20%22Original%20mode%20disabled%20due%20to%20previous%20failure.%20Use%20retry%20in%20restoration%20panel.%22%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%3A%20%22Safe%20mode%20requested%20by%20user.%22%3B%0A%20%20%20%20%20%20%20%20mountSafeMode(rootElement%2C%20React%2C%20createRoot%2C%20msg)%3B%0A%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20console.log(%22%5BBOOT%5D%20Attempting%20Original%20App...%22)%3B%0A%20%20%20%20updateBadge(%60ORIGINAL%20%7C%20%24%7BBUILD_ID%7D%60)%3B%0A%20%20%20%20%0A%20%20%20%20let%20hasMounted%20%3D%20false%3B%0A%20%20%20%20const%20timeout%20%3D%20setTimeout(()%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20if%20(!hasMounted)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20console.error(%22%5BBOOT%5D%20Timeout.%22)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20updateBadge(%60SAFE%20(Timeout)%20%7C%20%24%7BBUILD_ID%7D%60)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20mountSafeMode(rootElement%2C%20React%2C%20createRoot%2C%20%22Original%20app%20timed%20out%20(2s).%22)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%2C%202000)%3B%0A%0A%20%20%20%20import('.%2Fapp.original.tsx')%0A%20%20%20%20%20%20%20%20.then(module%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20clearTimeout(timeout)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20hasMounted%20%3D%20true%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20module.mount%20%3D%3D%3D%20'function')%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20module.mount(rootElement%2C%20React%2C%20createRoot)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20updateBadge(%60ORIGINAL%20%7C%20%24%7BBUILD_ID%7D%60)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20catch%20(e)%20%7B%20throw%20e%3B%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error(%22Missing%20mount()%22)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D)%0A%20%20%20%20%20%20%20%20.catch(err%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20clearTimeout(timeout)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20console.error(%22%5BBOOT%5D%20Failed%3A%22%2C%20err)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20localStorage.setItem(%22weflora.originalDisabled%22%2C%20%221%22)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20updateBadge(%60SAFE%20(Crash)%20%7C%20%24%7BBUILD_ID%7D%60)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20mountSafeMode(rootElement%2C%20React%2C%20createRoot%2C%20%60Crash%3A%20%24%7Berr.message%7D.%20Original%20mode%20disabled.%60)%3B%0A%20%20%20%20%20%20%20%20%7D)%3B%0A%7D"
      ]
    }
    </script>
    
    <!-- 2) BOOTSTRAP LOGIC -->
    <script type="module">
      window.logDiag("[BOOT] Index module started.");
      
      const BADGE = document.getElementById('runtime-badge');
      const updateBadge = (text, isErr) => {
          BADGE.textContent = text;
          if (isErr) BADGE.classList.add('error');
      };
      window.updateBadgeGlobal = updateBadge;

      // MANDATORY PIN: React 18.2.0 via jsDelivr
      const REACT_URL = "https://cdn.jsdelivr.net/npm/react@18.2.0/+esm";
      const DOM_URL = "https://cdn.jsdelivr.net/npm/react-dom@18.2.0/client/+esm";

      async function boot() {
        try {
          updateBadge("Loading React 18...");
          window.logDiag("[BOOT] Fetching React 18 from jsDelivr...");
          
          const [ReactMod, DomMod] = await Promise.all([
            import(REACT_URL),
            import(DOM_URL)
          ]);
          
          const React = ReactMod.default || ReactMod;
          const { createRoot } = DomMod.default || DomMod;

          // VERSION GUARD
          window.logDiag(`[BOOT] React loaded. Version: ${React.version}`);
          if (!React.version.startsWith('18.2')) {
              const msg = `React Drift Detected! Expected 18.2.x, got ${React.version}`;
              updateBadge(msg, true);
              throw new Error(msg);
          }

          // STRATEGY SELECTION
          let AppEntry;
          let strategy = "A";
          // Strict Sandbox Detection
          if (window.location.origin.includes('ai.studio') || window.location.protocol === 'file:') {
              window.logDiag("[BOOT] Sandbox detected. Forcing Strategy B.");
              strategy = "B";
          }

          updateBadge(`React v${React.version} | Strat: ${strategy} | Booting...`);

          if (strategy === "A") {
              try {
                  const appUrl = "./app.entry.mjs?t=" + Date.now();
                  const r = await fetch(appUrl);
                  if (!r.ok) throw new Error(`Fetch ${r.status}`);
                  const txt = await r.text();
                  if (txt.trim().startsWith('<')) throw new Error("HTML response");
                  AppEntry = await import(appUrl);
                  window.logDiag("[BOOT] Strategy A: Loaded.");
              } catch (e) {
                  window.logDiag(`[BOOT] Strategy A failed (${e.message}). Falling back.`);
                  strategy = "B";
              }
          }

          if (strategy === "B") {
              window.logDiag("[BOOT] Strategy B: Using embedded URI-Encoded JS Source.");
              const jsonEl = document.getElementById("app-source-json");
              if (!jsonEl) throw new Error("Missing #app-source-json");
              
              const rawJson = jsonEl.textContent;
              let data;
              try {
                  data = JSON.parse(rawJson);
              } catch (e) {
                  const snippet = rawJson.substring(0, 200);
                  throw new Error(`JSON Parse failed: ${e.message}. Snippet: ${snippet}...`);
              }

              if (!data.jsChunksEnc || !Array.isArray(data.jsChunksEnc)) {
                  throw new Error("Invalid JSON: 'jsChunksEnc' array missing");
              }

              // Decode URI components to reconstruct source
              const src = data.jsChunksEnc.map(chunk => decodeURIComponent(chunk)).join("");
              window.logDiag(`[BOOT] Decoded ${data.jsChunksEnc.length} chunks. Total source length: ${src.length}`);
              
              // Basic Sanity Check
              if (!src.includes("export") || !src.includes("mount")) {
                  throw new Error("Source does not look like a module (missing export/mount)");
              }

              window.logDiag(`[BOOT] Head: ${src.substring(0, 100).replace(/\n/g, ' ')}`);
              window.logDiag(`[BOOT] Tail: ${src.substring(src.length - 200).replace(/\n/g, ' ')}`);

              // Import via Blob
              const blob = new Blob([src], { type: 'text/javascript' });
              const blobUrl = URL.createObjectURL(blob);
              window.logDiag(`[BOOT] Created Blob URL: ${blobUrl}`);
              
              try {
                  AppEntry = await import(blobUrl);
                  window.logDiag(`[BOOT] AppEntry loaded. Keys: ${Object.keys(AppEntry).join(', ')}`);
              } catch (importErr) {
                  throw new Error(`Import failed: ${importErr.message}`);
              } finally {
                  URL.revokeObjectURL(blobUrl);
              }
          }
          
          const rootEl = document.getElementById("root");
          if (!rootEl) throw new Error("Missing #root");

          if (AppEntry && typeof AppEntry.mount === 'function') {
              window.logDiag("[BOOT] Handing over to AppEntry.mount()...");
              
              try {
                  AppEntry.mount(rootEl, React, createRoot);
                  window.logDiag("[BOOT] AppEntry.mount() returned.");
              } catch (mountErr) {
                  console.error("[BOOT] mount() threw:", mountErr);
                  window.logDiag(`[BOOT] CRITICAL: mount() failed: ${mountErr.message}`);
                  updateBadge(`MOUNT FAIL: ${mountErr.message}`, true);
              }

              setTimeout(() => {
                  if (rootEl.childNodes.length === 0) {
                      const msg = "Watchdog: Root empty after 250ms.";
                      console.error(`[BOOT] ${msg}`);
                      window.logDiag(`[BOOT] ${msg}`);
                      updateBadge("WATCHDOG: ROOT EMPTY", true);
                      const errDiv = document.createElement('div');
                      errDiv.style.cssText = "position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:white;padding:20px;border:2px solid red;color:red;font-weight:bold;z-index:99999;";
                      errDiv.textContent = "CRITICAL BOOT FAILURE: Root empty.";
                      document.body.appendChild(errDiv);
                  } else {
                      window.logDiag("[BOOT] Watchdog passed (Root has content).");
                  }
              }, 250);

          } else {
              throw new Error("Invalid AppEntry (missing mount)");
          }

        } catch (e) {
          window.logDiag(`[BOOT] CRITICAL FAILURE: ${e.message}`);
          console.error(e);
          updateBadge(`BOOT FAIL: ${e.message}`, true);
          
          document.body.innerHTML = `
            <div style="color:red;padding:20px;font-family:monospace;background:#fff;border:4px solid red;margin:20px;">
                <h1 style="font-size:24px;margin-bottom:10px;">Boot Failure (Strategy B - Raw Source)</h1>
                <p><strong>Error:</strong> ${e.message}</p>
                <div style="background:#eee;padding:10px;margin-top:20px;overflow:auto;max-height:400px;font-size:12px;">
                    <h3>Debug Log:</h3>
                    <pre>${window.errLog.join('\n')}</pre>
                </div>
            </div>
          `;
        }
      }

      boot();
    </script>
  </body>
</html>